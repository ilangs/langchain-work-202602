from callFunction import ChatOpenAI,PromptTemplate

# 다른 모듈
from langchain.chains import ConversationChain #대화흐름을 관리하는 체인
#1.추가
from langchain.memory import ConversationSummaryMemory #대화 요약 메모리 모듈

#2.모델 설정(안정적인 gtp-4o-mini)
llm = ChatOpenAI(model="gpt-4o-mini",temperature=0.7)# 

#3.요약 메모리 설정:대화내용을 요약해서 기억하며 이전 맥락을 파악하게 한다.
memory = ConversationSummaryMemory(llm=llm)

#4.프롬프트 정의
template = """당신은 AI 여행 비서 '트래블 GPT'입니다.
이전 대화에서 나눈 도시와 활동들을 요약된 기록 ({history})을 통해 파악하고 다음 물음에 답하세요.

[제약조건]
- 답변 시작시 반드시 "이전 여행 내용을 바탕으로 추천드리면..." 문구를 포함할 것.
- 부산 -> 여수 ->강릉으로 이어지는 동선을 고려하여 테마(가족/커플/힐링)에 맞는 제안을 할것.

사용자:{input}
AI:"""

# 프롬프트 설계(1.input_variables=[,,한개이상의 키이상],template=변수대입
prompt = PromptTemplate(input_variables=["history","input"],template=template)

#5.대화체인 생성:LLM,메모리,프롬프트를 =>하나   | | | =>ConversationChain
conversation = ConversationChain(
    llm = llm,
    memory = memory,
    prompt = prompt,
    verbose = False # True=>요약과정 등 내부 로그를 볼 수 있다.
)
# --- 시나리오 기반 대화 실행 (처음부터 1.이전 대화를 기억+2.요약하면서 이전대화를 기억하라.)---

# [첫 번째 도시: 부산]
print("사용자: 이번 주말엔 부산 갈 건데 가족 여행지 좀 추천해줘.")
#predict=>요약하는기능(내부적)
res1 = conversation.predict(input="이번 주말엔 부산 갈 건데 가족 여행지 좀 추천해줘.")
print(f"AI: {res1}\n")#요약을 하면서 가진상태

# [두 번째 도시: 여수] - 이전 '부산 가족 여행' 맥락 유지
print("사용자: 이번엔 여수로 가볼까?")
res2 = conversation.predict(input="이번엔 여수로 가볼까?")
print(f"AI: {res2}\n")

# [세 번째 도시: 강릉] - 부산, 여수 경험을 종합한 제안
print("사용자: 그럼 마지막은 강릉이 좋을까?")
res3 = conversation.predict(input="그럼 마지막은 강릉이 좋을까?")
print(f"AI: {res3}")

"""
사용자: 이번 주말엔 부산 갈 건데 가족 여행지 좀 추천해줘.
AI: 이전 여행 내용을 바탕으로 추천드리면, 부산에서 가족과 함께 즐길 수 있는 다양한 활동을 제안드릴게요.

1. **해운대 해수욕장**: 가족과 함께 해변에서 수영을 하거나 모래놀이를 즐길 수 있는 좋은 장소입니다. 주변에는 다양한 음식점과 카페도 많아 편리합니다.

2. **부산 아쿠아리움**: 아이들과 함께 신나는 바닷속 세계를 경험할 수 있는 아쿠아리움입니다. 다양한  해양 생물들을 가까이에서 관찰하며 교육적인 경험도 할 수 있습니다.

3. **부산타워**: 부산의 전경을 한눈에 볼 수 있는 부산타워는 가족 사진 촬영에도 좋은 장소입니다. 타워 주변에는 산책할 수 있는 공원도 있어 여유로운 시간을 보낼 수 있습니다.

4. **자갈치 시장**: 신선한 해산물을 맛볼 수 있는 자갈치 시장은 가족 모두가 즐길 수 있는 먹거리 탐방 장소입니다. 다양한 해산물을 구경하며 구입해 보세요.

5. **태종대**: 아름다운 경치와 함께 자연을 느낄 수 있는 태종대는 가족 단위로 산책하기 좋은 코스입니 다. 바다를 배경으로 한 가족 사진도 멋지게 찍을 수 있습니다.

부산에서의 즐거운 가족 여행 되시길 바랍니다!

사용자: 이번엔 여수로 가볼까?
AI: 이전 여행 내용을 바탕으로 추천드리면, 여수에서 가족과 함께 즐길 수 있는 활동들을 소개해드릴게요.

1. **여수 해양공원**: 가족이 함께 바다를 감상하며 산책할 수 있는 곳으로, 다양한 해양 생물과 함께하는 체험도 가능합니다.

2. **여수 돌산공원**: 이곳에서는 아름다운 바다 경치를 감상하며 가족과 함께 피크닉을 즐길 수 있습니다. 특히 해질 무렵의 경관은 아름다움이 배가됩니다.

3. **오동도**: 자연 탐방과 함께 다양한 식물과 동물을 관찰할 수 있는 좋은 장소입니다. 산책로가 잘 조 성되어 있어 가족과 함께 걷기에 적합합니다.

4. **여수 수산시장**: 신선한 해산물을 맛볼 수 있는 기회가 많아, 아이들과 함께 다양한 음식을 시식해보는 경험도 좋습니다.

5. **여수 향일암**: 경치가 뛰어나고 조용한 분위기에서 힐링할 수 있는 장소입니다. 가족과 함께 산책하 며 마음의 여유를 찾을 수 있습니다.

이렇게 여수에서 가족과 함께 즐길 수 있는 다양한 활동들을 추천드립니다. 즐거운 여행 되세요!

사용자: 그럼 마지막은 강릉이 좋을까?
AI: 이전 여행 내용을 바탕으로 추천드리면, 강릉은 가족, 커플, 힐링 테마에 모두 적합한 멋진 여행지입니다.

1. **가족 여행**: 강릉의 **경포대**는 해변과 아름다운 경치를 즐길 수 있는 곳으로, 가족과 함께 피크닉을 하거나 해변에서 놀기에 좋습니다. 또한 **강릉 아트센터**에서는 다양한 문화 체험 프로그램이 있어 아이들과 함께 즐길 수 있는 활동이 많습니다.

2. **커플 여행**: **주문진 해변**은 아름다운 일몰 전망으로 유명해 커플들이 로맨틱한 시간을 보내기에 완벽한 장소입니다. 또한, **정동진**에서는 바다와 기차가 어우러진 멋진 풍경을 감상할 수 있어 잊지 못 할 순간을 만들 수 있습니다.

3. **힐링 여행**: **선교장**은 전통 한옥에서의 편안한 시간을 보낼 수 있는 곳으로, 조용한 정원과 함께 힐링을 원하는 분들에게 추천드립니다. 또한, **오죽헌**은 아름다운 자연 속에서 고요한 시간을 보낼 수 있는 장소입니다.

강릉에서의 멋진 여행을 기대해보세요!
"""
    






