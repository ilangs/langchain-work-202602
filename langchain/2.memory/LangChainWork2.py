from callFunction import *
from langchain.memory import ConversationSummaryMemory

llm = ChatOpenAI(model="gpt-4o-mini")

parser = StrOutputParser()

memory = ConversationSummaryMemory(llm=llm, return_messages=True)

prompt = ChatPromptTemplate.from_messages([
    ("system", """당신은 AI 여행 비서 트래블 GPT 입니다.
     
    [핵심 규칙]
    - 당신은 사용자와 대화를 주고받는 중입니다. 
    - 만약 아래 '이전 대화 요약' 섹션에 내용이 존재한다면, 이는 두 번째 이상의 질문이라는 뜻입니다.
    - 이전 대화 요약이 존재할 경우, 답변 서두에 반드시 "이전 여행 내용을 바탕으로 추천드리면," 문구를 포함하세요.
    - 요약 내용이 완전히 비어 있다면 첫 인사와 함께 바로 답변하세요.
    
    이전 대화 요약:{history}"""),
    ("user", "{question}")
])

chain = prompt | llm | parser

while True:
    user_input = input("\n사용자(종료는 exit 입력): ")
    if user_input.lower() == "exit":
        break
    
    history = memory.load_memory_variables({})["history"]
    
    response = chain.invoke({"question": user_input, "history": history})

    print(f"AI: {response}")
    
    memory.save_context({"input": user_input}, {"output": response})
    
'''
사용자(종료는 exit 입력): 이번 주말 부산 여행지 추천 해줘                        
AI: 안녕하세요! 부산 여행에 대해 추천드릴게요.

부산은 다양한 매력을 가진 도시로, 다음과 같은 장소를 추천합니다:

1. **해운대 해수욕장**: 부드러운 백사장과 푸른 바다가 있는 대표적인 해수욕장입니다.
2. **광안리 해수욕장**: 멋진 야경을 감상할 수 있는 곳으로, 해변가를 산책하기 좋습니다.
3. **자갈치 시장**: 신선한 해산물을 즐길 수 있는 유명한 시장입니다. 
4. **부산 타워**: 용두산 공원에 위치하여 부산 시내 전경을 감상할 수 있는 장소입니다.
5. **감천문화마을**: 독특한 건축과 예술작품이 가득한 사진 찍기 좋은 곳입니다.

부산에서 멋진 주말 보내세요! 추가로 궁금한 사항이 있으시면 말씀해 주세요.

사용자(종료는 exit 입력): 여수는 어떨까?
AI: 이전 여행 내용을 바탕으로 추천드리면, 여수는 아름다운 해안선과 다양한 관광지가 매력적입니다.

여수를 방문할 경우, 다음과 같은 추천 장소가 있습니다:

1. **여수 엑스포 공원**: 2012년 여수세계박람회가 열린 곳으로, 해양과 환경 전시와 시설이 있습니다.
2. **돌산대교**: 여수와 돌산을 연결하는 다리로, 아름다운 야경과 함께 드라이브를 즐기기에 좋습니다.        
3. **향일암**: 뛰어난 경치를 자랑하는 사찰로, 일출 명소로도 유명합니다.
4. **오동도**: 섬이자 공원으로, 다양한 꽃과 해안 경치를 감상할 수 있는 산책로가 있습니다.
5. **여수 밤바다**: 야경이 뛰어나며, 바다를 감상하면서 맛있는 해산물을 즐길 수 있는 좋은 장소입니다.      

여수에서 멋진 시간을 보내시길 바랍니다! 추가로 궁금한 점이 있으시면 말씀해 주세요.

사용자(종료는 exit 입력): 그럼 강릉은 어때?
AI: 이전 여행 내용을 바탕으로 추천드리면, 강릉은 아름다운 해변과 자연경관으로 유명한 도시입니다. 
강릉에서 추천드릴 만한 장소는 다음과 같습니다:

1. **경포대**: 아름다운 경치를 감상할 수 있는 전망대와 해수욕장이 있는 곳입니다.
2. **안목 해변**: 카페거리로 유명해 핫한 커피를 마시며 바다를 감상할 수 있습니다.
3. **강릉커피거리**: 다양한 커피 전문점이 밀집해 있어, 맛있는 커피를 즐길 수 있는 곳입니다.
4. **주문진항**: 신선한 해산물을 맛볼 수 있는 좋은 장소로, 항구의 분위기도 즐길 수 있습니다.
5. **대관령**: 웰빙 관광지로 유명하며, 트레킹과 자연을 즐길 수 있는 최고의 장소입니다.

강릉에서 멋진 시간을 보내세요! 추가 질문이 있으시면 언제든지 말씀해 주세요.

사용자(종료는 exit 입력): exit

'''

