from callFunction import *  # *: 모듈내에 있는 모든 요소 (클래스, 함수, ...)
# 다른 모듈 (여러 메시지를 통째로 삽입하는 자리표시자)
from langchain_core.prompts import MessagesPlaceholder  
# 추가 (대화 기록 전체 저장)
from langchain.memory import ConversationBufferMemory

llm = ChatOpenAI(model="gpt-4o-mini")  # OpenAI 채팅 모델 객체 생성

# 메모리 전체 기억 (이전 대화를 메세지 형태로 변환)
memory = ConversationBufferMemory(return_messages=True) 

prompt = ChatPromptTemplate.from_messages([  # 채팅 프롬프트 구조 정의
    ("system", "당신은 여행 전문가입니다. 질문에 친절하게 답변해 주세요."), # 시스템 역할 정의
    MessagesPlaceholder(variable_name="history"), # history 메모리에 저장된 값을 꺼내 와라
    ("human", "{input}")
])

chain = prompt | llm 

# 연속 대화 시뮬레이션 (사용자 입력을 순차적으로 물어보게 코딩)
inputs = [
    "부산 여행지 추천해 줘.", 
    "그 여행지의 맛집도 추천해 줘", 
    "그 근처의 디저트 맛집도 추천해줘", 
    "전에 내가 추천요청한 부산 여행지 알지?"
]

for user_input in inputs:
    # 메모리에 저장된 갑을 꺼내 와라 (매개변수값(딕셔너리객체))
    #   -> 입력받은 값이 없다는 표시 ex) {"input": "안녕하세요"}
    # 반환받을 때 딕셔너리의 키 중 하나가 "history" 키값으로 저장된 값을 꺼내 와라
    #   ex) {"history": "사용자: 부산 여행지 추천해 줘."}
    history = memory.load_memory_variables({})["history"]
    # 새롭게 입력을 받을 때마다 이전에 저장된 데이터를 같이 전달
    result = chain.invoke({"history": history, "input": user_input}) 
    # 결과 출력
    print(f"\n사용자:{user_input}\n응답:{result.content}")
    # 메모리에 저장 (현재 입력값과 모델 응답값을 계속해서 요청할 때마다 누적해서 저장)
    memory.save_context({"input": user_input}, {"output": result.content}) # 출력 문자열만 저장
    
    '''
    사용자:부산 여행지 추천해 줘.
응답:부산은 한국에서 두 번째로 큰 도시로, 아름다운 해변과 풍부한 문화가 어우러진 매력적인 여행지입 니다. 부산에서 추천할 만한 여행지를 몇 곳 소개해드릴게요.

1. **해운대 해수욕장**: 부산에서 가장 유명한 해변으로, 여름철에는 많은 관광객들이 찾습니다. 주변에 는 맛있는 해산물 식당과 카페도 많으니 즐길 거리가 풍부합니다.

2. **광안리 해수욕장**: 광안대교의 멋진 야경을 감상할 수 있는 장소입니다. 해변을 따라 많은 바와 레 스토랑이 있어 저녁에 여유롭게 산책하기 좋습니다.

3. **부산타워와 용두산 공원**: 부산의 전경을 한눈에 볼 수 있는 부산타워와 함께 경치 좋은 용두산 공 원이 있어 산책하기에도 좋은 장소입니다.

4. **감천문화마을**: 알록달록한 집들과 독특한 거리 예술로 유명한 문화 마을입니다. 아름다운 사진을  찍기 좋은 포토 스팟도 많습니다.

5. **자갈치 시장**: 신선한 해산물을 구매하고, 지역 음식을 즐길 수 있는 시장입니다. 다양한 해산물 요리를 맛볼 수 있습니다.

6. **BIFF 광장**: 부산국제영화제의 중심지로, 영화 관련 체험과 다양한 음식도 즐길 수 있습니다. 분위 기가 좋고 사람들도 많아 활기찬 곳입니다.

7. **부산대학교**: 아름다운 캠퍼스를 갖춘 부산의 명문 대학으로, 산책하기 좋은 곳입니다. 특히 가을에는 단풍이 아름답습니다.

각기 다른 매력을 가진 부산의 여행지를 즐기시며 멋진 추억 만드셨으면 좋겠습니다!

사용자:그 여행지의 맛집도 추천해 줘
응답:부산의 여행지와 함께 방문할 수 있는 맛집을 추천해드릴게요!

1. **해운대 해수욕장 근처**:
   - **해운대 소문난 암소갈비**: 부드러운 갈비를 맛볼 수 있는 유명한 고깃집입니다.
   - **Noodles & Company**: 해운대 해변 바라보며 맛볼 수 있는 아시아 국수 전문점입니다.

2. **광안리 해수욕장 근처**:
   - **광안리 마리나**: 해산물과 함께 다양한 메뉴가 있는 레스토랑입니다. View가 아주 좋습니다.     
   - **광안리 생선구이집 (원조생선구이)**: 신선한 생선구이를 맛볼 수 있는 집입니다. 간단한 안주와  함께 소주를 곁들여 즐기기 좋습니다.

3. **자갈치 시장 근처**:
   - **명품전복죽**: 신선한 전복으로 끓인 전복죽이 유명한 곳입니다. 영양 만점의 식사로 좋습니다.   
   - **자갈치 생선회**: 자갈치 시장 내에서 제공하는 다양한 생선회를 저렴한 가격에 맛볼 수 있습니다.

4. **감천문화마을 근처**:
   - **사계절 감천**: 감천문화마을의 경치를 즐기며 먹을 수 있는 카페로, 이곳에서 다양한 음료와 간단한 식사를 즐길 수 있습니다.
   - **감천아이**: 감천문화마을의 분위기와 잘 어울리는 디저트 카페로, 예쁜 디저트가 많습니다.      

5. **BIFF 광장 근처**:
   - **부산 돼지국밥**: BIFF 광장 근처에 위치한 유명한 돼지국밥 집으로, 진한 국물 맛을 자랑합니다. 
   - **할매국수**: 부산의 대표적인 국수 맛집으로, 간편하게 한 끼를 해결하기 좋습니다.

부산의 다양한 맛집을 통해 지역 특색 있는 음식을 즐기면서 여행을 더욱 풍성하게 만들 수 있길 바랍니다!

사용자:그 근처의 디저트 맛집도 추천해줘
응답:부산의 인기 여행지 근처에 있는 디저트 맛집을 추천해드릴게요!

1. **해운대 해수욕장 근처**:
   - **해운대 빙수**: 다양한 종류의 빙수를 전문으로 하는 곳으로, 여름철에 특히 인기가 많습니다. 수 박 빙수나 망고 빙수가 유명합니다.
   - **카페 센텀**: 깔끔한 인테리어와 함께 다양한 디저트와 커피를 즐길 수 있는 카페입니다. 특히 케 이크가 맛있습니다.

2. **광안리 해수욕장 근처**:
   - **카페 드리프트**: 광안리 해변을 바라보며 커피와 디저트를 즐길 수 있는 테라스가 매력적인 카페 입니다. 다양한 케이크와 디저트가 준비되어 있습니다.
   - **핑크호떡**: 독특한 핫케이크와 다양한 토핑이 인기 있는 곳입니다. 귀엽고 인스타그램용 사진도  잘 나옵니다.

3. **자갈치 시장 근처**:
   - **카페 스위트 라이프**: 신선한 재료로 만든 디저트를 제공하는 카페로, 특히 커스터드 크림이 들어간 디저트가 인기가 많습니다.
   - **젤라또 알리오**: 자갈치 시장 근처에 위치한 젤라또 전문점으로, 다양한 맛의 수제 젤라또를 즐길 수 있습니다.
 수 있습니다.

4. **감천문화마을 근처**:
양한 디저트를 제공합니다. 특히 홈메이드 케이크가 추천입니다.
   - **카페 카라반**: 감천문화마을의 경치를 감상하며 차를 즐길 수 있는 곳으로, 독특한 디저트들이 많이 있습니다.

5. **BIFF 광장 근처**:
   - **동백나무집**: 전통적인 떡과 다과를 맛볼 수 있는 곳으로, 정성이 담긴 손수 만든 떡이 인기입니 다.
   - **쿠키닷컴**: 다양한 맛의 쿠키로 유명한 디저트 카페로, 커피와 함께 간단하게 즐기기 좋습니다.  

부산의 다양한 디저트 맛집을 통해 달콤한 휴식을 즐기며 여행의 즐거움을 더해보세요!

사용자:전에 내가 추천요청한 부산 여행지 알지?
응답:네, 전에 부산의 여행지로 해운대 해수욕장, 광안리 해수욕장, 부산타워, 감천문화마을, 자갈치 시장, BIFF 광장, 부산대학교를 추천해드렸어요. 어떤 추가 정보나 도움이 필요하신가요?

'''
    