'''
4. cookPlan.py (요리사 => 요리를 어떻게 결정해서 요리?)
'''

import streamlit as st                   # Streamlit 라이브러리 불러오기 (웹 UI 제작용)
from langchain_openai import ChatOpenAI  # OpenAI 기반 LLM(ChatGPT) 연결용
from langchain.tools import tool         # LangChain에서 도구를 정의할 수 있는 데코레이터 불러오기
from dotenv import load_dotenv           # 환경변수(.env 파일) 불러오기

load_dotenv()    # .env 파일에 저장된 API 키 등 환경변수 로드

# ===========================================================================================
# [1단계] 요리사가 쓸 수 있는 '도구'들의 설명서 만들기
# ===========================================================================================
@tool  # LangChain이 인식할 수 있도록 도구로 등록
def check_ingredient_price(item_name: str):  # 재료 가격을 조회하는 도구 정의
    """ 재료의 시장 가격을 조회합니다. 식재료 이름이 필요합니다."""  # 기능 설명 + 매개변수 설정
    return " 이 도구는 가격 조회용입니다."  # 실제 동작 대신 설명 문자열 반환

@tool  # 또 다른 도구 정의
def get_recipe(food_name: str):  # 음식 레시피를 조회하는 도구 정의
    """ 음식의 조리법(레시피)을 알려줍니다. 음식 이름이 필요합니다."""  # 기능 설명 + 매개변수 설정
    return " 이 도구는 레시피 검색용입니다."  # 실제 동작 대신 설명 문자열 반환

# ===========================================================================================
# [2단계] 요리사(LLM) 준비
# ===========================================================================================
# GPT-4o-mini 모델 불러오기, temperature=0으로 정확한 응답 설정
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)  

# 요리사에게 '너는 이런 도구를 쓸 수 있어'라고 교육하기 (바인딩)
# 이게 바로 핵심! bind_tools!
chef_with_tools = llm.bind_tools([check_ingredient_price, get_recipe]) 
# LLM에 도구들을 바인딩하여 사용할 수 있게 설정

# ===========================================================================================
# [3단계] 웹 화면 구성 및 판단 결과 보기
# ===========================================================================================
st.title("👨‍🍳  요리사의 판단 연습")  # 웹 앱 제목 표시

order = st.text_input("요리사에게 질문해보세요 (예: 고등어 가격 얼마야? 혹은 김치찌개 어떻게 만들어?)")  
# 사용자 입력창 생성 (질문 입력)

if order:  # 사용자가 질문을 입력했을 경우
    # 요리사가 질문을 듣고 판단합니다.
    response = chef_with_tools.invoke(order)  # LLM이 입력을 받아 응답 생성
    
    # 만약 요리사가 도구를 써야겠다고 판단했다면?
    if response.tool_calls:  # 응답에 도구 호출 계획이 포함되어 있다면 어떤 도구를 선택했는지 표시
        st.success(f"요리사의 판단: '{response.tool_calls[0]['name']}' 도구를 꺼내야겠군!")  
        # 내부적으로 만든 실행 계획서(JSON 형식) 출력
        st.json(response.tool_calls)  
    else:
        st.info("요리사의 판단: 이건 그냥 대화로 충분해. 도구는 필요 없어.")  
        # 도구가 필요 없을 경우 메시지 출력
        st.write(response.content)  # LLM의 일반 대화 응답 출력
   
 
     
        

# (.venv) C:\workAI\work\LangChain\5.agent>streamlit run 4.cookPlan.py

# -------------------------------------------------------------
# 고등어 가격 얼마야?

# 요리사의 판단: 'check_ingredient_price' 도구를 꺼내야겠군!

# [
# 0:{
# "name":"check_ingredient_price"
# "args":{
# "item_name":"고등어"
# }
# "id":"call_pXtxHTxv6iPRYX6lYNJA0MFU"
# "type":"tool_call"
# }
# ]
# -------------------------------------------------------------
# 오늘 날씨에 맞는 요리는 무엇일까?

# 요리사의 판단: 이건 그냥 대화로 충분해. 도구는 필요 없어.

# 오늘의 날씨에 맞는 요리를 추천하기 위해서는 현재 날씨 정보가 필요합니다. 오늘의 날씨를 알려주시면 그에 맞는 요리를 추천해드리겠습니다!

